https://svn.gsotgroup.vn:8443/svn/AdminTool
@using System.Security.AccessControl
@using Modules.Common
@using Modules.Common.Data
@using Modules.WebApp.Areas.AppCommon.Models.Shared
@using System.Data
@using System.Windows.Forms
@using Modules.WebApp.Areas.AppCommon.Controllers
@using Modules.WebApp.Areas.AppCommon.Models.Shared.FilterControls
@inherits Cx.Framework.Web.Razor.CxWebViewPage<dynamic>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<div class="row">
    <div class="col-sm-3" id="option_tinhdiem">
        <h3>Tính điểm trung bình</h3>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" checked value="Tính điểm trung bình học kỳ"> <span class="label-text">Tính điểm trung bình học kỳ</span>
            </label>
        </div>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" value="Tính điểm trung bình năm học"> <span class="label-text">Tính điểm trung bình năm học</span>
            </label>
        </div>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" value="Tính điểm trung bình toàn khóa"> <span class="label-text">Tính điểm trung bình toàn khóa</span>
            </label>
        </div>
    </div>
@Html.Partial("~/Areas/AppCommon/Views/Shared/EditFormPartial.cshtml", new EditDataModel
{
    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh",
    Id = "14",
    MoreExp = "",
    Layout = "editForm"
})

<div class="row">
    <div class="col-lg-12">
        <button id="TinhDiem" type="button" style="margin:5px 0;" class="btnSubmit validate btn blue btn-lg pull-right uppercase">Tính điểm</button>
    </div>
</div>

@Html.Partial("~/Areas/AppCommon/Views/Shared/DataTablePartial.cshtml", new DataTableModel
{
    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh",
    MoreExp = "",
    Layout = "table",
    UseAjax = false,
    ShowHeader = false
})
<style>
    /*#div_HocKy_Id, #vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh_NienKhoa-edit-form {
        display: none;
    }*/
</style>
<script type="text/javascript">
    var idSelected = [];
    $('#TinhDiem').click(function (e) {
        e.preventDefault();
        var nienkhoa_id;


    })
    //Radio button on change event
    $(document).ready(function () {
        $('input[name*="schoolyear"]').attr('disabled', true);
        $('input:radio[name=radio]').change(function () {
            if (this.value == 'Tính điểm trung bình học kỳ') {
                $('select[name*="HocKy_Id"]').attr('disabled', false);
                $('input[name*="schoolyear"]').attr('disabled', true);
            }
            else if (this.value == 'Tính điểm trung bình năm học') {
                $('select[name*="HocKy_Id"]').attr('disabled', true);
                $('input[name*="schoolyear"]').attr('disabled', false);
            }
            else if (this.value == 'Tính điểm trung bình toàn khóa') {
                $('select[name*="HocKy_Id"]').attr('disabled', true);
                $('input[name*="schoolyear"]').attr('disabled', true);
            }
        });
        //Show, Hide button
        $("#vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh-btn-cancel,#vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh-btn-update,#btExport_vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh,#btnFullRow_vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh").remove();

    })

</script>
UtilitiesController.cs
 public ActionResult RunCommand(string formActionID)
        {
            int rowID = -1;
            try
            {
                rowID = int.Parse(DataAccessContants.DataProvider.Decrypt_Try_Encode(formActionID));
            }
            catch
            {

            }            
            if (rowID == -1)
            {               
                return Content("-1");
            }

            DataTable tbGenTableDefine_FormAction = new DataTable("GenTableDefine_FormAction");
            DataAccessContants.DataProvider.FillTable(ref tbGenTableDefine_FormAction, "Select * from tbGenTableDefine_FormAction Where ID=" + formActionID);
            if (tbGenTableDefine_FormAction.Rows.Count == 0)
            {
                return Content("-1");
            }
            DataRowView drv = tbGenTableDefine_FormAction.DefaultView[0];
            string sql = "";
            if (drv["SQLBefore"] != DBNull.Value)
            {
                sql = drv["SQLBefore"].ToString();
            }
            sql = sql.Replace("{", "");
            sql = sql.Replace("}", "");

            string param = Request.QueryString.ToString();
            NameValueCollection qscoll = HttpUtility.ParseQueryString(param);
            foreach (string key in qscoll)
            {
                var value = qscoll[key];
                if (value.IndexOf(";") >= 0)
                {
                    value = " IN (" + value.Replace(";", ",") + ")";
                    sql = sql.Replace("=[" + key + "]", value);
                    sql = sql.Replace("= [" + key + "]", value);
                }
                else
                    sql = sql.Replace("[" + key + "]", value);
            }
            sql = DataAccessContants.DataProvider.ReplaceDefault(sql);

            int er= DataAccessContants.DataProvider.ExecuteCommand(sql);
            return Content(er.ToString());
        }
