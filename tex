using Modules.Common.Data;
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace Modules.WebApp.Controllers
{
    public class SUNISDiemTrungBinhController : Controller
    {
        // GET: SUNISDiemTrungBinh
        public ActionResult Index()
        {
            return View();
        }
        public void TinhDiemTrungBinh(int nienkhoaId,int lophocId,int hockyId,int sinhvienId,string namhoc)
        {
            DataTable tbDiemTrungBinh= new DataTable("tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh");
            DataTable tbTemp = new DataTable();
            DataAccessContants.DataProvider.FillTable(ref tbTemp, "select sv.ID from tb_SUNSIS_HCMUNRE_SV_Sinhvien sv inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id = sv.Adminclassid"+
            " inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion = ctdtnk.ID" +
            " inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID = ctdtnk.ayyear"+
            " where lh.Id =" + lophocId+" and nk.ID ="+nienkhoaId+ " and sv.ID=" + sinhvienId);
            foreach (DataRow dataRows in tbTemp.Rows)
            {
                int ID=dataRows.Field<int>("ID");

            }
            //DataTable tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh = new DataTable("tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh");
            //DataAccessContants.DataProvider.FillTable(ref tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh, "Select");

            //DataTable tbTemp = new DataTable();
            //DataAccessContants.DataProvider.FillTable(ref tbTemp, "Select");

            ////Dung for de tinh, tinh xong gan vao 1 data

            ////Update
            //tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.Rows[0]["DiemTB"] = 4.5;

            ////Insert
            //DataRow drnew = tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.NewRow();
            //tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.Rows.Add(drnew);
            //drnew["DiemTB"] = 4.5;
            //drnew["DiemChu"] = "Năm";
            //drnew["NgayTinh"] = DateTime.Now;

            ////Luu du lieu

            //DataAccessContants.DataProvider.SaveDataTableBulkCopy(tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh);

        }
    }
}












@using System.Security.AccessControl
@using Modules.Common
@using Modules.Common.Data
@using Modules.WebApp.Areas.AppCommon.Models.Shared
@using System.Data
@using System.Windows.Forms
@using Modules.WebApp.Areas.AppCommon.Controllers
@using Modules.WebApp.Areas.AppCommon.Models.Shared.FilterControls
@inherits Cx.Framework.Web.Razor.CxWebViewPage<dynamic>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<div class="row">
    <div class="col-sm-3" id="option_tinhdiem">
        <h3>Tính điểm trung bình</h3>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" checked value="Tính điểm trung bình học kỳ"> <span class="label-text">Tính điểm trung bình học kỳ</span>
            </label>
        </div>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" value="Tính điểm trung bình năm học"> <span class="label-text">Tính điểm trung bình năm học</span>
            </label>
        </div>
        <div class="form-check">
            <label>
                <input type="radio" name="radio" value="Tính điểm trung bình toàn khóa"> <span class="label-text">Tính điểm trung bình toàn khóa</span>
            </label>
        </div>
    </div>
</div>
@Html.Partial("~/Areas/AppCommon/Views/Shared/EditFormPartial.cshtml", new EditDataModel
{
    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh",
    Id = "14",
    MoreExp = "",
    Layout = "editForm"
})
<div class="row">
    <div class="col-lg-12">
        <button id="TinhDiem" type="button" style="margin:5px 0;" class="btnSubmit validate btn blue btn-lg pull-right uppercase">Tính điểm</button>
    </div>
</div>
<div id="DiemTB">
    </div>
    <div id="DiemTB">
        <div id="DiemTB_HocKy">
                @Html.Partial("~/Areas/AppCommon/Views/Shared/DataTablePartial.cshtml", new DataTableModel
                {
                    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh",
                    MoreExp = "",
                    Layout = "table",
                    UseAjax = false,
                    ShowHeader = false
                })
            </div>
            </div>
            <div id="DiemTB_NamHoc">
                @Html.Partial("~/Areas/AppCommon/Views/Shared/DataTablePartial.cshtml", new DataTableModel
                {
                    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_NamHoc",
                    MoreExp = "",
                    Layout = "table",
                    UseAjax = false,
                    ShowHeader = false
                })
            </div>
            </div>
            <div id="DiemTB_NienKhoa">
                @Html.Partial("~/Areas/AppCommon/Views/Shared/DataTablePartial.cshtml", new DataTableModel
                {
                    TableName = "vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_NienKhoa",
                    MoreExp = "",
                    Layout = "table",
                    UseAjax = false,
                    ShowHeader = false
                })
            </div>
            </div>
            </div>
    <style>
        /*#DiemTB_HocKy, #DiemTB_NienKhoa, #DiemTB_NamHoc{
            display:none;
        }*/
    </style>
    <script type="text/javascript">
    var idSelected = [];
    //function DiemTrungBinhDaTa() {
    //    var nienkhoa_id = $('select[name*="NienKhoa_Id"]').val();
    //    var lophoc_id = $('select[name*="LopHoc_Id"]').val();
    //    var hocky_id = $('select[name*="HocKy_Id"]').val();
    //    var namhoc = null;
    //    if (lophoc_id == "-1") {
    //        lophoc_id = null;
    //    }
    //    if (hocky_id == "-1") {
    //        hocky_id = null;
    //    }
    //    var valueDataToSend = $('input[name=radio]:checked').val();
    //    if (valueDataToSend == 'Tính điểm trung bình học kỳ') {
    //        var dataToSend = {
    //            text: 'uTISRxj9FJY3h+yNENOhsV/mKDi6X6a5wRJ9A0HX6Ayn+7xZAyxnS++6nB1JIsZp7r8B9wfm+navURdWG+3OqKlyruR0dbtbbLlqs1cHg8KizKTOebsiEm1+SjdW2OWd8N3yLISiwRJ99vVbl2DUdA==',
    //            paramvalue: nienkhoa_id + ',' + lophoc_id + ',' + hocky_id
    //        };
    //    }
    //    else if (valueDataToSend == 'Tính điểm trung bình năm học') {
    //        var dataToSend = {
    //            text: 'uTISRxj9FJY3h+yNENOhsV/mKDi6X6a5wRJ9A0HX6Ayn+7xZAyxnS++6nB1JIsZp7r8B9wfm+navURdWG+3OqKlyruR0dbtbbLlqs1cHg8K1IpEc8BmsAAOOWuDb2q5QhL7SkWgQx/11pSuol5mCDfmkl4/7D99Kd0vHwai9lpk=',
    //            paramvalue: nienkhoa_id + ',' + lophoc_id + ',' + namhoc
    //        };
    //    }
    //    else if (valueDataToSend == 'Tính điểm trung bình toàn khóa') {
    //        var dataToSend = {
    //            text: 'uTISRxj9FJY3h+yNENOhsV/mKDi6X6a5wRJ9A0HX6Ayn+7xZAyxnS++6nB1JIsZp7r8B9wfm+navURdWG+3OqKlyruR0dbtbbLlqs1cHg8K1IpEc8BmsAFjv1NUZia1TOohRVYemVgq5Q3fJlkESKQF03+zuclrC4bNZzMPWx5s=',
    //            paramvalue: nienkhoa_id + ',' + lophoc_id
    //        };
    //    }
    //    $.post({
    //        module: "",
    //        url: "/AppCommon/Utilities/RunSql",
    //        showMask: true,
    //        async: false,
    //        data: dataToSend,
    //        success: function () {
    //            $('body').load();
    //        }
    //    })
    //}
    $('#TinhDiem').click(function (e) {
        e.preventDefault();
        var nienkhoa_id = $('select[name*="NienKhoa_Id"]').val();
        var lophoc_id = $('select[name*="LopHoc_Id"]').val();
        var hocky_id = $('select[name*="HocKy_Id"]').val();
        var sinhvienid = $('select[name*="Sinhvien_Id"]').val();
        var namhoc = null;
        var parameters = '{nienkhoaId:' + nienkhoa_id + ',lophocId:' + lophoc_id + ',hockyId:' + hocky_id + ',sinhvienId:'+sinhvienid+', namhoc:'+namhoc+'}';
        //DiemTrungBinhDaTa();
        $.ajax({
            url: '/SUNISDiemTrungBinh/TinhDiemTrungBinh',
            type: 'POST',
            data: parameters,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {

            }
        })
    })
    //Radio button on change event
        $(document).ready(function () {
        $('input[name*="schoolyear"]').attr('disabled', true);
        $('input:radio[name=radio]').change(function () {
            if (this.value == 'Tính điểm trung bình học kỳ') {
                $('select[name*="HocKy_Id"]').attr('disabled', false);
                $('input[name*="schoolyear"]').attr('disabled', true);
            }
            else if (this.value == 'Tính điểm trung bình năm học') {
                $('select[name*="HocKy_Id"]').attr('disabled', true);
                $('input[name*="schoolyear"]').attr('disabled', false);
                @*$('#DiemTB').load('@Url.Action("PartialDiem", "SUNIS")');*@
            }
            else if (this.value == 'Tính điểm trung bình toàn khóa') {
                $('select[name*="HocKy_Id"]').attr('disabled', true);
                $('input[name*="schoolyear"]').attr('disabled', true);
            }
        });
        $("#vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh-btn-cancel,#vw_tb_SUNSIS_HCMUNRE_QLD_TinhDiemTrungBinh-btn-update,#btExport_vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh,#btnFullRow_vw_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh").remove();

    })

    </script>
















using Modules.Common.Data;
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace Modules.WebApp.Controllers
{
    public class SUNISDiemTrungBinhController : Controller
    {
        // GET: SUNISDiemTrungBinh
        public ActionResult Index()
        {
            return View();
        }
        public void TinhDiemTrungBinh(int sinhvienID, int nienkhoa)
        {
            DataTable tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh = new DataTable("tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh");
            DataAccessContants.DataProvider.FillTable(ref tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh, "Select");

            DataTable tbTemp = new DataTable();
            DataAccessContants.DataProvider.FillTable(ref tbTemp, "Select");

            //Dung for de tinh, tinh xong gan vao 1 data

            //Update
            tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.Rows[0]["DiemTB"] = 4.5;

            //Insert
            DataRow drnew = tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.NewRow();
            tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh.Rows.Add(drnew);
            drnew["DiemTB"] = 4.5;
            drnew["DiemChu"] = "Năm";
            drnew["NgayTinh"] = DateTime.Now;

            //Luu du lieu

            DataAccessContants.DataProvider.SaveDataTableBulkCopy(tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh);

        }
    }
}
















/*
--diem thi dai hoc
SELECT dhcq.HO, dhcq.TEN, dhcq.KHUVUC, dhcq.SOBAODANH, dhcq.DM1, dhcq.DM2, dhcq.DM3, dhcq.AY
FROM TBL_TMP_PASSEDSTUDENTDHCQ dhcq
WHERE dhcq.TEN='Ch?n'


SELECT  parent.NAME as "ROOT_NAME", root.NAME, root.PATH, parent.NAME as "ROOT_NAME"
FROM TBL_STU_PAGE root left OUTER join TBL_STU_PAGE parent on root.PARENTID=parent.ID
ORDER BY parent.Name



SELECT qrys.QUERYDISPLAY, qrys.QUERYNAME, qrys.QUERYSTRING, sTab.TABLENAME
FROM TBL_HUR_QUERYSTRING qrys inner join LST_SEARCH_TABLE sTab on qrys.TABLEID=sTab.ID

--L?ch thi
SELECT std.FIRSTNAME, teld.SBD, teld.LANTHI, teld.CAMTHI, teld.STUDYTIMES, teld.MARKNUMBER, teld.SEMESTER, es.ESNAME, teld.EXAMORDER 
        ,c.COURSENAME, tel.CODEDST, tel.NGAYTHI, tel.CATHI, tel.HK, tel.NAMHOC
FROM TBL_EXA_TABLEEXAMLISTDETAIL teld inner join TBL_EXA_TABLEEXAMLIST tel on teld.LICHTHIID=tel.ID1111111111
        inner join TBL_STU_STUDENT std on teld.STUDENTID=std.ID
        inner join TBL_ES_EXAMSCHEDULE es on teld.EXAMSCHEDULEID=es.ID
        inner join TBL_TSY_COURSE c on tel.COURSEID=c.ID
        
---danh sách list
select TBL_CTL_CATALOGUEINFO.NAME,LST_RPT_MODULE.CODE,TBL_CTL_CATALOGUEINFO.TABLENAME,LST_RPT_MODULE.NAME 
from TBL_CTL_CATALOGUEINFO inner join LST_RPT_MODULE on TBL_CTL_CATALOGUEINFO.MODULEID= LST_RPT_MODULE.ID
where TBL_CTL_CATALOGUEINFO.TABLENAME='lst_tsy_FormOfEducation'
= 'lst_tsy_FormOfEducation'


--diem thi
select d.FIRSTNAME,b.COURSENAME,a.MARK,a.mark4,f.CODE,f.NAME,c.NAME,a.RESULT,e.FORMULARSTRING,g.FULLNAME from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
inner join TBL_PNT_MARKFORMULAR e on c.ID=e.MARKTYPEID
inner join LST_PNT_SYMBOLMARK f on f.ID=a.SYMBOLMARKID
inner join TBL_STU_USER g on g.id=a.USERID
where a.STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'    




--diem trung binh he 10
SELECT * FROM TBL_PNT_SUMMARISEMARK a inner join TBL_STU_STUDENT b on a.STUDENTID=b.ID
where a.STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'



--diem trung binh he 4
SELECT * FROM TBL_PNT_SUMMARISEMARK_HE4 a inner join TBL_STU_STUDENT b on a.STUDENTID=b.ID
where a.STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'

--thong tin hoc bong
select a.FIRSTNAME,b.class,b.DHT,b.DRL,b.DTBMR,b.SEMESTER,c.NAME,d.NAME from TBL_STU_STUDENT a inner join TBL_SH_STUDENTSHOLASHIP b on a.ID=b.STUDENTID
inner join LST_SH_SCHOLARSHIPLEVEL c on b.LEVELS=c.ID
inner join TBL_SH_SCHOLARSHIPFUND d on b.SCHOLARSHIPFUNDID=d.ID
where a.ID=C


select * from TBL_STU_STUDENT inner join TBL_TSY_ADMINISTRATIVECLASS on TBL_STU_STUDENT.ADMINCLASSID=TBL_TSY_ADMINISTRATIVECLASS.ID where TBL_STU_STUDENT.ADMINCLASSID='A3A37E38F6084F37A7324EA22D9AAC50' 

---study warning
select * from LST_TSY_STUDYWARNINGLEVEL a inner join TBL_TSY_STUDYWARNING b on a.id=b.WARNINGLEVELID
where b.STUDENTID='2cec51cfe30746a4942d85ded2559b4b'

--quyet dinh khen thuong ky luat
SELECT * from TBL_STU_STUDENTDECISION inner join TBL_STU_STUDENT on TBL_STU_STUDENTDECISION.STUDENTID=TBL_STU_STUDENT.ID where TBL_STU_STUDENT.COTTAM='02_ÐHCNTT_1'


select TBL_CTL_CATALOGUEINFO.NAME,LST_RPT_MODULE.CODE,TBL_CTL_CATALOGUEINFO.TABLENAME,LST_RPT_MODULE.NAME 
from TBL_CTL_CATALOGUEINFO inner join LST_RPT_MODULE on TBL_CTL_CATALOGUEINFO.MODULEID= LST_RPT_MODULE.ID

select TBL_CTL_CATALOGUEINFO.NAME,LST_RPT_MODULE.CODE,TBL_CTL_CATALOGUEINFO.TABLENAME,LST_RPT_MODULE.NAME 
from TBL_CTL_CATALOGUEINFO inner join LST_RPT_MODULE on TBL_CTL_CATALOGUEINFO.MODULEID= LST_RPT_MODULE.ID
-- dem record table
select
   table_name,
   to_number(
   extractvalue(
      xmltype(
         dbms_xmlgen.getxml('select count(*) c from '||table_name))
    ,'/ROWSET/ROW/C')) count
from 
   user_tables
order by 
   table_name;

SELECT name FROM V$DATAFILE;
SELECT member FROM V$LOGFILE;





select group#, archived, status from v$log;




select * from TBL_TSY_CURRICULUMNINSEMESTER a inner join TBL_TSY_ADMINISTRATIVECLASS b on a.ADMINCLASSID=b.ID where a.adminclassid='AC7B5D8957864C27A95EE9ABC7A15AEF'

select a.FIELDNAME,b.AMOUNTOFYEAR,c.NUMBEROFSEM,c.AYNAME from LST_TSY_FIELD a inner join TBL_TSY_TRAININGSYSTEM b on a.TRAININGSYSTEMID=b.ID 
inner join TBL_TSY_ACADEMICYEAR c on c.TRAININGSYSTEMID=b.id
where c.AYNAME='DHCQ02'


SELECT
    hh.id,hh.AYNAME,gg.ID, c.COURSENAME, sem.NAME, sem.SCHOOLYEAR,sem.id,cc.id
FROM TBL_TSY_COURSE_CURRIINSEM cc inner join TBL_TSY_CURRICULUMNINSEMESTER cis on cc.CURRIINSEMESTERID=cis.ID
inner join TBL_TSY_COURSE c on cc.COURSEID=c.ID
inner join TBL_TSY_SEMESTER sem on cis.SEMESTERID=sem.ID
inner join TBL_TSY_TRAININGSYSTEM gg on gg.id=c.TRAININGSYSTEMID
inner join TBL_TSY_ACADEMICYEAR hh on hh.TRAININGSYSTEMID=gg.id
WHERE cis.ADMINCLASSID='AC7B5D8957864C27A95EE9ABC7A15AEF' and hh.ID='16C89C8C3FB244B08FAD6110A6A81958'
order by sem.SCHOOLYEAR, sem.NAME



select b.NAME,c.CLASSNAME,c.CLASSNAMETA,b.SCHOOLYEAR
from TBL_TSY_CURRICULUMNINSEMESTER a inner join TBL_TSY_SEMESTER b on b.id=a.SEMESTERID
inner join TBL_TSY_ADMINISTRATIVECLASS c on c.id=a.ADMINCLASSID
where a.ADMINCLASSID='A552D73350BB4467A0C3E14AAF322FFB'


SELECT
     c.COURSENAME, sem.NAME, sem.SCHOOLYEAR,DD.STAGENAME,EE.CLASSNAME
FROM TBL_TSY_COURSE_CURRIINSEM cc inner join TBL_TSY_CURRICULUMNINSEMESTER cis on cc.CURRIINSEMESTERID=cis.ID
inner join TBL_TSY_COURSE c on cc.COURSEID=c.ID
inner join TBL_TSY_SEMESTER sem on cis.SEMESTERID=sem.ID
inner join TBL_TSY_STAGEOFEDUCATION dd on dd.id=CIS.STAGEOFEDUCATIONID
inner join TBL_TSY_ADMINISTRATIVECLASS ee on ee.id=CIS.ADMINCLASSID
WHERE EE.CLASSNAME='01_LTCÐMT'
order by sem.SCHOOLYEAR, sem.NAME

SELECT
     c.COURSENAME, sem.NAME, sem.SCHOOLYEAR,DD.STAGENAME,EE.CLASSNAME,GG.SEMESTERORDER
FROM TBL_TSY_COURSE_CURRIINSEM cc inner join TBL_TSY_CURRICULUMNINSEMESTER cis on cc.CURRIINSEMESTERID=cis.ID
inner join TBL_TSY_COURSE_CURRIINSTAGE gg on GG.ID=CC.COURSECURRIINSTAGEID
inner join TBL_TSY_COURSE c on cc.COURSEID=c.ID
inner join TBL_TSY_SEMESTER sem on cis.SEMESTERID=sem.ID
inner join TBL_TSY_STAGEOFEDUCATION dd on dd.id=CIS.STAGEOFEDUCATIONID
inner join TBL_TSY_ADMINISTRATIVECLASS ee on ee.id=CIS.ADMINCLASSID
WHERE ee.id='80B4FA62599F4370A993B7DB7ED45FE3'
order by sem.SCHOOLYEAR, sem.NAME


select * from tbl_stu_student where code='0250080007'
72dcd4f915f745cbbf7bbe34c8e49977

select * from TBL_PNT_TABLEMARK where STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'

select b.COURSENAME,a.MARK,a.mark4,f.CODE,f.NAME,c.NAME,a.RESULT,e.FORMULARSTRING,g.FULLNAME from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
inner join TBL_PNT_MARKFORMULAR e on c.ID=e.MARKTYPEID
inner join LST_PNT_SYMBOLMARK f on f.ID=a.SYMBOLMARKID
inner join TBL_STU_USER g on g.id=a.USERID
where a.STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'  



select C.COURSENAME,A.MARK,A.SEMESTER,b.name,a.oldmark from TBL_PNT_TABLEMARK_HISTORY a 
inner JOIN LST_PNT_MARKTYPE b on A.MARKTYPEID=B.ID
inner join TBL_TSY_COURSE c on c.id=A.COURSEID
where STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'
and c.code='11121004'







--                                                    IMPORT DATA
Niên khóa
/*SELECT
     c.COURSENAME, sem.NAME, sem.SCHOOLYEAR,DD.STAGENAME,EE.CLASSNAME,GG.SEMESTERORDER
FROM TBL_TSY_COURSE_CURRIINSEM cc inner join TBL_TSY_CURRICULUMNINSEMESTER cis on cc.CURRIINSEMESTERID=cis.ID
inner join TBL_TSY_COURSE_CURRIINSTAGE gg on GG.ID=CC.COURSECURRIINSTAGEID
inner join TBL_TSY_COURSE c on cc.COURSEID=c.ID
inner join TBL_TSY_SEMESTER sem on cis.SEMESTERID=sem.ID
inner join TBL_TSY_STAGEOFEDUCATION dd on dd.id=CIS.STAGEOFEDUCATIONID
inner join TBL_TSY_ADMINISTRATIVECLASS ee on ee.id=CIS.ADMINCLASSID
WHERE ee.id='F9EBF3C7078F45F2932C5F9FF8220A57'
order by sem.SCHOOLYEAR, sem.NAME

select i.CODe||'_'||E.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where B.CLASSNAME='02_?HCNTT_1'
EF5A483E764D42CC8373D519E85C0E31
9ff4ebb1b66349e1b1ed13cd14074c32

//Ch?n ch??ng trình ?ào t?o
select distinct i.CODe||'_'||E.code,I.NAME||'_'||E.MAJORNAME||'_'||E.CODE,I.CODE,E.CODE from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID


select distinct i.CODe||'_CN_'||f.code,I.NAME||'_'||F.FIELDNAME||'_'||f.CODE,I.CODE,'CN'||'_'||f.CODE from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.fieldid
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID





--Ch?n version
select distinct G.STAGEOFEDUCATIONID,A.STAGENAME,i.CODe||'_'||E.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID

select distinct G.STAGEOFEDUCATIONID,A.STAGENAME,i.CODe||'_CN_'||f.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID

--Môn h?c cho version
select distinct D.COURSENAME||' ('||d.code||+')',g.stageofeducationid,C.SEMESTERORDER from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where B.CLASSNAME='02_?HCNTT_1'



select distinct g.stageofeducationid,D.COURSENAME||' ('||d.code||+')',C.SEMESTERORDER from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID



--Version cho niên khóa
select distinct H.CODE,G.STAGEOFEDUCATIONID from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where B.CLASSNAME='02_?HCNTT_1'



select distinct H.CODE,G.STAGEOFEDUCATIONID from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID


--L?p h?c


select a.code,A.CLASSNAME,A.TYPECLASS,A.CLASSNAMETA,A.OPENCLASSDAY,b.id from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
inner join LST_TSY_MAJORFIELD c on c.id=B.FIELDID


select a.code,A.CLASSNAME,A.TYPECLASS,A.CLASSNAMETA,A.OPENCLASSDAY,b.id from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
inner join LST_TSY_Field c on c.id=b.FIELDID



--Sinh viên

    select E.CLASSNAME,a.CODE,a.FIRSTNAME,a.LASTMIDDLENAME,to_char(a.BIRTHDATE,'DD/MM/YYYY'),a.PLACEOFBIRTH,B.CODE,
    a.TOTALMARK,MARK1,MARK2,MARK3,a.STUDENTSTATUS,C.CODE,a.DISTRICT,D.CODE,a.ORDERNUMBER,
    a.RESIDENTPOPULATION,a.GRADUATEDFROMHIGHSCHOOL,a.KHICANBAOTINCHO,a.MOBILE_BK,A.GENDER
    from tbl_stu_student a left join LST_STU_ZONE b on A.ZONEID=B.ID
    left join LST_STU_NATIONALITY c on A.NATIONALITYID=C.ID
    left join LST_COM_PROVINCE d on d.id=A.PROVINCEID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=A.ADMINCLASSID
where a.code='0250080007'
select count(*) from tbl_stu_student 
to_char(a.BIRTHDATE,'DD/MM/YYYY')

---Danh m?c h?c k?
select B.SCHOOLYEAR,B.ORDERINYEAR,B.STARTDATE,B.ENDDATE,B.SEMESTERORDER,B.CODE,A.CODE,B.CODE,b.name
from TBL_TSY_ACADEMICYEAR a inner join TBL_TSY_SEMESTER b on A.ID=B.AYID 





--Danh sách chuyên ngành d?a theo ngành
select distinct 'CN'||'_'|| D.CODE,D.FIELDNAME,D.FIELDNAME
from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
left join LST_TSY_MAJORFIELD c on c.id=B.FIELDID inner join lst_tsy_field d on d.id=B.FIELDID
where a.code not in(
select a1.code
from TBL_TSY_ADMINISTRATIVECLASS a1
inner join TBL_TSY_STAGEOFEDUCATION b1 on A1.STAGEOFEDUCATIONID=B1.ID
inner join LST_TSY_MAJORFIELD c1 on c1.id=B1.FIELDID)

--      

--Môn h?c
select a.code,A.COURSENAME,A.COURSECREDIT,C.CODE,B.CODE,a.nomark from TBL_tsy_course a inner join TBL_TSY_SUBJECT b on A.SUBJECTID=b.id
left join TBL_TSY_COURSETYPE c on c.id=A.COURSETYPEID


select distinct B.CODE,E.CODE as lop
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on A.COURSEID=b.id
inner join LST_PNT_MARKTYPE c on c.ID=A.MARKTYPEID
inner join TBL_STU_STUDENT d on A.STUDENTID=D.ID
inner join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID

select distinct c.name from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
inner join TBL_STU_USER g on g.id=a.USERID
inner join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
where a.STUDENTID='72dcd4f915f745cbbf7bbe34c8e49977'    
GROUP BY B.COURSENAME



--L?p môn h?c
select distinct E.CLASSNAME||'_'||b.code,E.CLASSNAME,b.COURSENAME||' ('||b.code||+')',a.semester
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID

where e.code='02_ĐHCNTT_1'
where e.classname is null


drop table bangdiem



--T?o b?ng ?i?m
create table BangDiem_15_03_18 as

(
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
a.MARK AS THI,NULL AS QT,NULL AS TKHP,NULL AS HP1,NULL AS HP2,NULL AS HP3,NULL AS HP4,c.code--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='THI'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,a.MARK AS QT,NULL AS TKHP,NULL AS HP1,NULL AS HP2,NULL AS HP3,NULL AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME ,a.studytimes,f.code
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='QT'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,a.MARK AS TKHP,NULL AS HP1,NULL AS HP2,NULL AS HP3,NULL AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='TKHP'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,NULL AS TKHP,a.MARK AS HP1,NULL AS HP2,NULL AS HP3,NULL AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='HP1'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,NULL AS TKHP,NULL AS HP1,a.mark AS HP2,NULL AS HP3,NULL AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='HP2'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,NULL AS TKHP,NULL AS HP1,NULL AS HP2,a.mark AS HP3,NULL AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='HP3'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,NULL AS TKHP,NULL AS HP1,NULL AS HP2,NULL AS HP3,a.mark AS HP4,--Here
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
WHERE c.CODE ='HP4'
)

Select db.MSSV,db.CLASSNAME||'_'||db.MAMH, MAX(db.QT) AS QT,MAX(db.THI) AS THI, MAX(db.TKHP) AS TKHP,
MAX(db.HP1) as HP1, MAX(db.HP2) as HP2,MAX(db.HP3) as HP3,MAX(db.HP4) as HP4,MAX(db.MARK4) AS HE4,db.studytimes, MAX(db.RESULT) as KetQua,MAX(db.Code) as KyHieuDiem
FROm BANGDIEM_15_03_18 db
--where db.mssv='0250080007'

GROUP BY db.MSSV,db.CLASSNAME,db.MAMH,db.studytimes




select distinct 'CN'||'_'|| D.CODE,D.FIELDNAME,D.FIELDNAME
from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
left LST_TSY_MAJORFIELD c on c.id=B.FIELDID inner join lst_tsy_field d on d.id=B.FIELDID
where a.code not in(
select a1.code
from TBL_TSY_ADMINISTRATIVECLASS a1
inner join TBL_TSY_STAGEOFEDUCATION b1 on A1.STAGEOFEDUCATIONID=B1.ID
inner join LST_TSY_MAJORFIELD c1 on c1.id=B1.FIELDID)

select distinct F.FIELDNAME,i.name||'_'||f.code,f.fieldnameenglish,I.NAME,K.CODE from TBL_TSY_STAGEOFEDUCATION a left join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
left join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
left join tbl_tsy_course d on d.id=C.COURSEID
left join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
left join lst_tsy_field f on f.id=E.FIELDID
left join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
left join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
left join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
left join LST_STU_GROUP k on k.DOITUONGTHONGTINLIENQUANID=f.FACULTYID
*/



select distinct E.CLASSNAME||'_'||b.code,E.CLASSNAME,b.COURSENAME||' ('||b.code||+')',b.code,a.semester,H.SYMBOL
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join TBL_TSY_STAGEOFEDUCATION f on E.STAGEOFEDUCATIONID=f.id
inner join TBL_TSY_ACADEMICYEAR h on h.id=F.AYID
inner join TBL_TSY_SEMESTER k on h.id=K.AYID
where e.code='02_ĐHCNTT_1'



















 select sv.ID,lmh.ID,dt.QT,dt.THI,dt.TKHP,khd.id,dt.Ketqua,dt.He4,dt.Lanhoc,dt.HP1,dt.HP2,dt.HP3,dt.HP4  from DataImport dt left join tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dt.MSSV=sv.Code
left join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.name=dt.CLASSNAME
left join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.Code=dt.MAMH
left join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh on lmh.Lophoc_Id=lh.ID and lmh.MonHoc=mh.ID
left join tb_SUNSIS_HCMUNRE_QLD_KyHieuDiem khd on dt.Kyhieudiem=khd.code
where dt.LopMonHoc=lmh.Ma_LopHoc and dt.MSSV=sv.code



insert into tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc_DSSinhVien(SinhVien_ID,Lop_MonHoc,Diem_QT,Diem_Thi,Diem_TongKet,Kyhieudiem,Ketqua,Diem_He4,Lanhoc,Diem_HP1,Diem_HP2,Diem_HP3,Diem_HP4)
 select sv.ID,lmh.ID,dt.QT,dt.THI,dt.TKHP,khd.id,dt.Ketqua,dt.He4,dt.Lanhoc,dt.HP1,dt.HP2,dt.HP3,dt.HP4  from DataImport dt inner join tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dt.MSSV=sv.Code
inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.name=dt.CLASSNAME
inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.Code=dt.MAMH
inner join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh on lmh.Lophoc_Id=lh.ID and lmh.MonHoc=mh.ID
left join tb_SUNSIS_HCMUNRE_QLD_KyHieuDiem khd on dt.Kyhieudiem=khd.code
where dt.MSSV='0250080007'




select * from fnSplitString((select NienKhoa_Id from tb_SUNSIS_HCMUNRE_QLD_QuyDinhKetQua where ID = 2),';')




--update hoc ky bang lop mon hoc
update lmh set lmh.HocKy=hk.ID from Import_HocKy imp inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.name=imp.CLASSNAME
inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.code=imp.CODE
inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
inner join tb_SUNSIS_HCMUNRE_DM_HK hk on hk.ayid=nk.ID and imp.SEMESTER=hk.NamHoc_HocKy and imp.SYMBOL=nk.Symbol
inner join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh on lh.Id=lmh.Lophoc_Id and lmh.MonHoc=mh.id
where imp.[E#CLASSNAME||'_'||B#CODE]=lmh.Ma_LopHoc



--Tính điểm trung bình hệ 10
create proc sp_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinhHe10
@LopHoc_Id int,
@HocKy_Id int
as
begin
declare @NienKhoa_Id int
declare @MonHoc_Id int
select @MonHoc_Id=lmh.MonHoc from tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh 
select @NienKhoa_Id=nk.ID from tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh
inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.ID=lmh.Lophoc_Id
inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.ID=lmh.MonHoc
inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
declare @dk int
select @dk=count(*) from tb_SUNSIS_HCMUNRE_QLD_QuyDinhKetQua where ';'+NienKhoa_Id+';' Like '%;40;%' and ';'+MonHoc_Id+';' Like '%;2243%;'
	if(@dk=0)
		begin
			select diem.SinhVien_ID,sum(mh.CourseCredit*diem.Diem_TongKet)/(sum(mh.CourseCredit)) as diem from tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc_DSSinhVien diem inner join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh
			on lmh.ID=diem.Lop_MonHoc
			inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.ID=lmh.Lophoc_Id
			inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.ID=lmh.MonHoc
			inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
			inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
			group by diem.SinhVien_ID,lmh.HocKy
			having diem.SinhVien_ID=177039
		end
end



SELECT DISTINCT b.HocKy,a.SinhVien_ID
,((sum(c.CourseCredit*a.Diem_He4) over(PARTITION BY a.SinhVien_ID, b.HocKy))/(sum (c.CourseCredit) over(PARTITION BY a.SinhVien_ID, b.HocKy))) as DTB
FROM tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc_DSSinhVien a
inner join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc b
inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH c
on c.id=b.MonHoc
on a.Lop_MonHoc=b.ID
where a.SinhVien_ID=154618 --and b.HocKy='2013_2014_2'
select * from tb_SUNSIS_HCMUNRE_SV_Sinhvien where Code='0250080007'

select * from tb_SUNSIS_HCMUNRE_QLD_QuyDinhKetQua
select * from tb_SUNSIS_HCMUNRE_QLLH_LH order by name asc

exec sp_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinhHe10 5838,4017725
go
select diem.SinhVien_ID,sum(mh.CourseCredit*diem.Diem_TongKet)/(sum(mh.CourseCredit)) as diem from tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc_DSSinhVien diem inner join tb_SUNSIS_HCMUNRE_QLLH_LopMonHoc lmh
			on lmh.ID=diem.Lop_MonHoc
			inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.ID=lmh.Lophoc_Id
			inner join tb_SUNSIS_HCMUNRE_QLCTDT_MH mh on mh.ID=lmh.MonHoc
			inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
			inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
			where 
			group by diem.SinhVien_ID,lmh.HocKy
			having diem.SinhVien_ID=177039
5838
4017725

select * from tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk inner join tb_SUNSIS_HCMUNRE_DM_HK hk on nk.id=hk.ayid where nk.id=66
select * from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh order by SinhVien_Id asc
delete from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh
exec sp_tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh 5838,4017725




125.212.244.168,12500
hcmunre.sunis
hcmunre@2017


Import_HocKy
nguyenngocchan
chan@gsot2018
