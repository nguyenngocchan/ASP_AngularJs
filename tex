<?xml version="1.0" encoding="utf-8"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=169433
  -->
<configuration>
  <configSections>
    <section name="database-definitions" type="Cx.Framework.EfDataAccess.Config.DatabaseDefinitions, Cx.Framework.EfDataAccess" />
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
    <section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
    <section name="botDetect" requirePermission="false" type="BotDetect.Configuration.BotDetectConfigurationSection, BotDetect" />
    <!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 -->
    <sectionGroup name="dotNetOpenAuth" type="DotNetOpenAuth.Configuration.DotNetOpenAuthSection, DotNetOpenAuth.Core">
      <section name="messaging" type="DotNetOpenAuth.Configuration.MessagingElement, DotNetOpenAuth.Core" requirePermission="false" allowLocation="true" />
      <section name="reporting" type="DotNetOpenAuth.Configuration.ReportingElement, DotNetOpenAuth.Core" requirePermission="false" allowLocation="true" />
      <section name="oauth" type="DotNetOpenAuth.Configuration.OAuthElement, DotNetOpenAuth.OAuth" requirePermission="false" allowLocation="true" />
      <section name="openid" type="DotNetOpenAuth.Configuration.OpenIdElement, DotNetOpenAuth.OpenId" requirePermission="false" allowLocation="true" />
    </sectionGroup>
  </configSections>
  <database-definitions>
    <definition connString="" schema="dbo" />
  </database-definitions>
  <appSettings>
    <!--the configuration of mvc-->
    <add key="aspnet:MaxJsonDeserializerMembers" value="150000" />
    <add key="webpages:Version" value="3.0.0.0" />
    <add key="webpages:Enabled" value="false" />
    <add key="ClientValidationEnabled" value="true" />
    <add key="UnobtrusiveJavaScriptEnabled" value="true" />
    <!--Run-->

    <!--<add key="ConnectString" value="Pi9GCErXULHzO1I9CzYJ+HnoJPu+VxMzy2D9ep5AswwF6FqZbc3vbLzr5MTDlFG9vTfbA/hYE3GR7fLWpEIHXJKrWIU40zKuBZGcv9ihF84GtcxuuvvObx4tNC3xMy+EXzyNlw0nO+xXa5+cVqchYh+9LqRAFlhi/uEbMdvhUHtPgamLXmgIlCzlKa1od7sDzu68OACzS5/W/G09zS5myQDxE+38bTrtReWsFZCX7emWjHZOoum+RLPYdY8RmChigbztiUEfN3br6SFGwOjzmYAyCNTBAqZ8N1/b8HEJ5WNuSS0RjtXztQ==" />-->
    <add key="ConnectString" value="Pi9GCErXULHzO1I9CzYJ+HnoJPu+VxMzy2D9ep5Aswzr1KDmhYyYYqp0h+LjPBaR8Wq+u/ksQb5p36zhhIjK1pkWhNsTbawAX600QISBVlfPbZtv3dlBX3ykLLnDl8Hwzm9PLUxJpGlnOeAjKNsllpl3nyPSmv5nJSo+S8a6LysxGeMRRE7OV1HwEszIzztZE1KTOZd3ZIGQJHUoMcP0Wu5lfepe5ANUIAylXjLCnhH8pVKFlYI3Glb1C5hmlOAMeGqOqFFri/4=" />
    <add key="ShowedColMaxNumber" value="20" />
    <add key="EmailContact" value="K3vn4QV3A9WnXdjev8QJ9x4i4kjAajz69DMyLwUE0TcX2DVfmFDGivhmoiH2CsMqNIlzGiapq+8=" />
    <add key="PasswordEmailContact" value="+4NuWiri26aVSOuxQGUEq4qo0pG8/9WYB6azjXRMloM0I2Q7mE90+L8g0rMddm6E" />
    <add key="EmailGopY" value="K3vn4QV3A9WnXdjev8QJ9x4i4kjAajz69DMyLwUE0TcX2DVfmFDGivhmoiH2CsMqNIlzGiapq+8=" />
    <!--Login Email-->
    <add key="google_clientId" value="794865269895-l6m9un0dm1seb80r5udecql1pqos951t.apps.googleusercontent.com" />
    <add key="google_clientEmail" value="" />
    <add key="google_clientSerect" value="g0BZHUajiULWebEX2V4hX9HY" />
    <add key="RedirectUrl" value="" />
    <add key="google_JavaScriptOrigin" value="http://localhost:9001" />
    <add key="HostMail" value="smtp.gmail.com" />
    <add key="HostMailPort" value="587" />
    <!-- Visibility will not filter to children -->
    <add key="MvcSiteMapProvider_VisibilityAffectsDescendants" value="false" />
    <!-- Set default visibility provider -->
    <add key="MvcSiteMapProvider_DefaultSiteMapNodeVisibiltyProvider" value="MvcSiteMapProvider.FilteredSiteMapNodeVisibilityProvider, MvcSiteMapProvider" />
    <add key="MvcSiteMapProvider_UseExternalDIContainer" value="false" />
    <add key="MvcSiteMapProvider_ScanAssembliesForSiteMapNodes" value="true" />
    <add key="MvcSiteMapProvider_IncludeAssembliesForScan" value="Modules.WebApp" />
  </appSettings>

  <system.web>
    <compilation defaultLanguage="c#" targetFramework="4.5" debug="true">
      <assemblies>
        <add assembly="System.IO.Compression.FileSystem, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />
      </assemblies>
    </compilation>
    <httpRuntime targetFramework="4.5" maxRequestLength="2147483647" maxQueryStringLength="2097151" maxUrlLength="2097151" />
    <authentication mode="Forms">
      <forms cookieless="UseCookies" loginUrl="/" timeout="2880" />
    </authentication>
    <globalization fileEncoding="UTF-8" requestEncoding="UTF-8" responseEncoding="UTF-8" />
    <pages enableSessionState="true">
      <namespaces>
        <add namespace="System.Web.Helpers" />
        <add namespace="System.Web.Mvc" />
        <add namespace="System.Web.Mvc.Ajax" />
        <add namespace="System.Web.Mvc.Html" />
        <add namespace="System.Web.Optimization" />
        <add namespace="System.Web.Routing" />
        <add namespace="System.Web.WebPages" />
        <add namespace="MvcSiteMapProvider.Web.Html" />
        <add namespace="MvcSiteMapProvider.Web.Html.Models" />
      </namespaces>
      <controls>
        <add assembly="BotDetect" namespace="BotDetect.Web.UI" tagPrefix="BotDetect" />
      </controls>
    </pages>
    <!-- Turn on Custom Errors -->
    <customErrors mode="Off">
    </customErrors>
    <httpHandlers>
      <add verb="GET" path="BotDetectCaptcha.ashx" type="BotDetect.Web.CaptchaHandler, BotDetect" />
    </httpHandlers>
    <sessionState mode="InProc" cookieless="AutoDetect" timeout="5000" sessionIDManagerType="BotDetect.Web.CustomSessionIdManager, BotDetect" />
  </system.web>
  <system.webServer>
    <security>
      <requestFiltering>
        <requestLimits maxAllowedContentLength="1073741824" maxQueryString="2097151" />
      </requestFiltering>
    </security>
    <!--<staticContent>
      <mimeMap fileExtension=".json" mimeType="application/json" />
    </staticContent>-->
    <validation validateIntegratedModeConfiguration="false" />
    <modules runAllManagedModulesForAllRequests="true">
      <remove name="UrlRoutingModule-4.0" />
      <add name="UrlRoutingModule-4.0" type="System.Web.Routing.UrlRoutingModule" />
    </modules>
    <handlers>
      <remove name="SimpleHandlerFactory-Integrated" />
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" />
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness32" responseBufferLimit="0" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness64" responseBufferLimit="0" />
       <add name="SimpleHandlerFactory-Integrated" path="*.ashx" verb="GET,HEAD,POST,DEBUG,DELETE" type="System.Web.UI.SimpleHandlerFactory" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode" />
      <remove name="BotDetectCaptchaHandler" />
      <add name="BotDetectCaptchaHandler" preCondition="integratedMode" verb="GET" path="BotDetectCaptcha.ashx" type="BotDetect.Web.CaptchaHandler, BotDetect" />
    <remove name="ExtensionlessUrlHandler-Integrated-4.0" /><remove name="OPTIONSVerbHandler" /><remove name="TRACEVerbHandler" /><add name="ExtensionlessUrlHandler-Integrated-4.0" path="*." verb="*" type="System.Web.Handlers.TransferRequestHandler" preCondition="integratedMode,runtimeVersionv4.0" /></handlers>
        <urlCompression doStaticCompression="false" />
  </system.webServer>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="WebGrease" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-1.6.5135.21930" newVersion="1.6.5135.21930" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-11.0.0.0" newVersion="11.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Http" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Net.Http.Formatting" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Helpers" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.4.0" newVersion="5.2.4.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="DotNetOpenAuth.AspNet" publicKeyToken="2780ccd10d57b246" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-4.3.0.0" newVersion="4.3.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="DotNetOpenAuth.Core" publicKeyToken="2780ccd10d57b246" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-4.3.0.0" newVersion="4.3.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Antlr3.Runtime" publicKeyToken="eb42632606e9261f" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.5.0.2" newVersion="3.5.0.2" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="EPPlus" publicKeyToken="ea159fdaa78159a1" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-4.5.0.3" newVersion="4.1.1.0" />
      </dependentAssembly>
    </assemblyBinding>
    <!-- This prevents the Windows Event Log from frequently logging that HMAC1 is being used (when the other party needs it). -->
    <legacyHMACWarning enabled="0" />
    <!-- When targeting ASP.NET MVC 3, this assemblyBinding makes MVC 1 and 2 references relink
		     to MVC 3 so libraries such as DotNetOpenAuth that compile against MVC 1 will work with it.
		<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
			<dependentAssembly>
				<assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" />
				<bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
			</dependentAssembly>
		</assemblyBinding>
		 -->
  </runtime>
  <entityFramework>
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" />
    <providers>
      <provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
    </providers>
  </entityFramework>
  <botDetect>
    <captchaImage>
      <helpLink enabled="true" mode="image" />
    </captchaImage>
  </botDetect>
  <system.net>
    <defaultProxy enabled="true" />
    <settings>
      <!-- This setting causes .NET to check certificate revocation lists (CRL) 
			     before trusting HTTPS certificates.  But this setting tends to not 
			     be allowed in shared hosting environments. -->
      <!--<servicePointManager checkCertificateRevocationList="true"/>-->
    </settings>
  </system.net>
  <dotNetOpenAuth>
    <messaging>
      <untrustedWebRequest>
        <whitelistHosts>
          <!-- Uncomment to enable communication with localhost (should generally not activate in production!) -->
          <!--<add name="localhost" />-->
        </whitelistHosts>
      </untrustedWebRequest>
    </messaging>
    <!-- Allow DotNetOpenAuth to publish usage statistics to library authors to improve the library. -->
    <reporting enabled="true" />
    <!-- This is an optional configuration section where aspects of dotnetopenauth can be customized. -->
    <!-- For a complete set of configuration options see http://www.dotnetopenauth.net/developers/code-snippets/configuration-options/ -->
    <openid>
      <relyingParty>
        <security requireSsl="false">
          <!-- Uncomment the trustedProviders tag if your relying party should only accept positive assertions from a closed set of OpenID Providers. -->
          <!--<trustedProviders rejectAssertionsFromUntrustedProviders="true">
						<add endpoint="https://www.google.com/accounts/o8/ud" />
					</trustedProviders>-->
        </security>
        <behaviors>
          <!-- The following OPTIONAL behavior allows RPs to use SREG only, but be compatible
					     with OPs that use Attribute Exchange (in various formats). -->
          <add type="DotNetOpenAuth.OpenId.RelyingParty.Behaviors.AXFetchAsSregTransform, DotNetOpenAuth.OpenId.RelyingParty" />
        </behaviors>
      </relyingParty>
    </openid>
  </dotNetOpenAuth>
  <uri>
    <!-- The uri section is necessary to turn on .NET 3.5 support for IDN (international domain names),
		     which is necessary for OpenID urls with unicode characters in the domain/host name.
		     It is also required to put the Uri class into RFC 3986 escaping mode, which OpenID and OAuth require. -->
    <idn enabled="All" />
    <iriParsing enabled="true" />
  </uri>
</configuration>





declare @nienkhoa_id int
declare @hocky_id int
declare @nganh_id int
declare @chuyennganh_id int
declare @lophoc int


set @nienkhoa_id=1106
set @hocky_id=4018969
set @nganh_id =20
set @chuyennganh_id =7
set @lophoc =6204


declare @quyche_id int
select	@quyche_id=Quyche_Id from tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa where id=@nienkhoa_id

declare @tmp_DTBC table(SinhVien_Id int,DTBC float,DTBTL float,TCTL int,DieuKien nvarchar(255))
declare @tmp_DTBTL table(SinhVien_Id int,DTBC float,DTBTL float,TCTL int,DieuKien nvarchar(255))
declare @tmp_Ketqua table(SinhVien_Id int,DTBC float,DTBTL float,TCTL int,DieuKien nvarchar(255),hocky_id int)
declare @DTBC float
declare @DTBC_1 float
declare @DTBCTL_N1 float
declare @DTBCTL_N2 float
declare @DTBCTL_N3 float
declare @DTBCTL_NC float
declare @stthk int
select @stthk=semesterorder from tb_SUNSIS_HCMUNRE_DM_HK where id=@hocky_id
select @DTBC=DTBC,@DTBC_1=DTBC_1,@DTBCTL_N1=DTBTL_N1,@DTBCTL_N2=DTBTL_N2,@DTBCTL_N3=DTBTL_N3,@DTBCTL_NC=DTBC_NC from tb_SUNSIS_HCMUNRE_Quyche_Hocvu where Quyche_Id=@quyche_id


if(@stthk=1)
	begin
		insert into @tmp_DTBC(SinhVien_Id,DTBC,DTBTL,DieuKien)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình trung học kỳ đầu'+cast(dtb.DTBC_He4 as nvarchar)
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id=@hocky_id
		and dtb.DTBC_He4<@DTBC
	end
else
	begin
		insert into @tmp_DTBC(SinhVien_Id,DTBC,DTBTL,DieuKien)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình trung học kỳ 2'+cast(dtb.DTBC_He4 as nvarchar)
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id=@hocky_id
		and dtb.DTBC_He4<@DTBC_1
	end
if(@stthk=1 or @stthk=2)
	begin
	select 1
		insert into @tmp_DTBTL(SinhVien_Id,DTBC,DTBTL,DieuKien,TCTL)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình tích lũy năm 1'+cast(dtb.DTBTL_He4 as nvarchar),dtb.DTBTL_Tinchi
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id is null and dtb.Namhoc is null
		and dtb.DTBTL_He4<@DTBCTL_N1
	end
else if(@stthk=3 or @stthk=4)
	begin
	select 2
		insert into @tmp_DTBTL(SinhVien_Id,DTBC,DTBTL,DieuKien,TCTL)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình tích lũy năm 2'+cast(dtb.DTBTL_He4 as nvarchar),dtb.DTBTL_Tinchi
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id is null and dtb.Namhoc is null
		and dtb.DTBTL_He4<@DTBCTL_N2
	end
else if(@stthk=5 or @stthk=6)
	begin
	select 3
		insert into @tmp_DTBTL(SinhVien_Id,DTBC,DTBTL,DieuKien,TCTL)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình tích lũy năm 3'+cast(dtb.DTBTL_He4 as nvarchar),dtb.DTBTL_Tinchi
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id is null and dtb.Namhoc is null
		and dtb.DTBTL_He4<@DTBCTL_N3
	end
else
	begin
	select 4
		insert into @tmp_DTBTL(SinhVien_Id,DTBC,DTBTL,DieuKien,TCTL)
		select dtb.Sinhvien_Id,dtb.DTBC_He4,dtb.DTBTL_He4,'Điểm trung bình tích lũy năm 4'+cast(dtb.DTBTL_He4 as nvarchar),dtb.DTBTL_Tinchi
		from tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb join  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv on dtb.Sinhvien_Id=sv.ID
		inner join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		where nk.id=@nienkhoa_id and cn.id=@chuyennganh_id and cn.field=@nganh_id and lh.id=@lophoc and dtb.Hocky_Id is null and dtb.Namhoc is null
		and dtb.DTBTL_He4<@DTBCTL_NC
	end
insert into @tmp_Ketqua(SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,hocky_id)
select SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,@hocky_id
from @tmp_DTBC
where SinhVien_Id not in (select SinhVien_Id from @tmp_DTBTL)

insert into @tmp_Ketqua(SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,hocky_id)
select SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,@hocky_id
from @tmp_DTBTL
where SinhVien_Id not in (select SinhVien_Id from @tmp_DTBC)

insert into @tmp_Ketqua(SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,hocky_id)
select tbc.SinhVien_Id,tbc.DTBC,tbtl.DTBTL,tbtl.TCTL,tbc.DieuKien+';'+tbtl.DieuKien ,@hocky_id
from @tmp_DTBTL tbtl join @tmp_DTBC tbc on tbc.SinhVien_Id=tbtl.SinhVien_Id

select * from @tmp_DTBC
select * from @tmp_DTBTL
select * from @tmp_Ketqua

declare @index int
declare @count_sv int
select @count_sv=count(*) from @tmp_Ketqua
SET @index=1
WHILE(@index<=@count_sv)
	BEGIN
		declare @check_exists int
		declare @Sinhvien_Id int
		declare @lock int
		declare @STT int
		select @Sinhvien_Id=svid from(
		select SinhVien_Id as svid,ROW_NUMBER() OVER(order by SinhVien_Id) as STT
		from @tmp_Ketqua)as b
		WHERE b.STT=@index
		select @check_exists=count (*) from tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua where Sinhvien_Id=@Sinhvien_Id 
		select @lock=lock from tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua where Sinhvien_Id=@Sinhvien_Id 
		select @STT=max(STT) from tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua where Sinhvien_Id=@Sinhvien_Id 
		if(@check_exists>1 and @lock>0)
		begin
			insert into tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua(SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,Lock,STT,Hocky_Id)
			select SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,@lock+1,@STT+1,hocky_id from @tmp_Ketqua 
			where SinhVien_Id=@Sinhvien_Id
		end
		else
		begin
			insert into tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua(SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,Lock,STT,Hocky_Id)
			select SinhVien_Id,DTBC,DTBTL,TCTL,DieuKien,1,1,hocky_id from @tmp_Ketqua
			where SinhVien_Id=@Sinhvien_Id
		end
		SET @index=@index+1
	end
	select * from  tb_SUNSIS_HCMUNRE_SV_Sinhvien sv  join tb_SUNSIS_HCMUNRE_QLLH_LH lh on lh.id=sv.Adminclassid
		inner join tb_SUNSIS_HCMUNRE_QLCTDT_NK ctdtnk on lh.ayversion=ctdtnk.ID
		inner join tb_SUNSIS_HCMUNRE_Danhmuc_NienKhoa nk on nk.ID=ctdtnk.ayyear
		join tb_SUNSIS_HCMUNRE_QLCTDT_VERSION vs on vs.id=ctdtnk.Version
		join tb_SUNSIS_HCMUNRE_QLCTDT_CTDT ctdt on ctdt.id=vs.Trainid
		join tb_SUNSIS_HCMUNRE_Danhmuc_chuyennganh cn on cn.ID=ctdt.majorfield
		join tb_SUNSIS_HCMUNRE_QLD_DiemTrungBinh_All dtb on dtb.Sinhvien_Id=sv.id 
		where sv.ID not in (select SinhVien_Id from @tmp_Ketqua) and nk.id=@nienkhoa_id
		and lh.id=@lophoc and cn.id=@chuyennganh_id and cn.field=@nganh_id and dtb.Hocky_Id=@hocky_id
	select * from tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua
	delete tb_SUNSIS_HCMUNRE_Quyche_Hocvu_Ketqua












/*
--Danh m?c ngành
select distinct  F.FIELDNAME,i.name||'_'||f.code,f.fieldnameenglish,I.NAME,K.CODE from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
left join LST_STU_GROUP k on k.DOITUONGTHONGTINLIENQUANID=f.FACULTYID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'


select distinct  F.FIELDNAME,i.name||'_'||f.code,f.fieldnameenglish,I.NAME,K.CODE from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.fieldid
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
left join LST_STU_GROUP k on k.DOITUONGTHONGTINLIENQUANID=f.FACULTYID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

--Danh m?c chuyên ngành
select distinct i.CODe||'_'||E.CODE,E.MAJORNAME,i.code||'_'||f.code,E.MAJORNAMEENGLISH from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 			
a.id=B.STAGEOFEDUCATIONID			
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID			
inner join tbl_tsy_course d on d.id=C.COURSEID			
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID			
inner join lst_tsy_field f on f.id=E.FIELDID			
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID			
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID			
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID			
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

select distinct i.code||'_'||'CN'||'_'|| f.CODE,'CN'||'_'||FIELDNAME,i.code||'_'||f.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 			
a.id=B.STAGEOFEDUCATIONID			
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID			
inner join tbl_tsy_course d on d.id=C.COURSEID			
left join LST_TSY_MAJORFIELD e on e.id=A.FIELDID			
inner join lst_tsy_field f on f.id=a.FIELDID			
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID			
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID			
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID			
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

--Ch??ng trình ?ào t?o
select distinct 'CTDT'||'_'||i.CODe||'_'||E.code,I.NAME||'_'||E.MAJORNAME,i.code||'_'||E.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'


select distinct 'CTDT'||'_'||i.CODe||'_'||'CN'||'_'|| f.CODE,I.NAME||'_'||'CN'||'_'||FIELDNAME,i.code||'_'||'CN'||'_'|| f.CODE from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
left join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

---Phiên b?n ch??ng trình ?ào t?o
select distinct G.STAGEOFEDUCATIONID,A.STAGENAME, 'CTDT'||'_'||i.CODe||'_'||E.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'


select distinct G.STAGEOFEDUCATIONID,A.STAGENAME,'CTDT'||'_'||i.CODe||'_CN_'||f.code from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

---Môn h?c
select  a.code,A.COURSENAME,A.COURSECREDIT,C.CODE,B.CODE,a.nomark from TBL_tsy_course a left join TBL_TSY_SUBJECT b on A.SUBJECTID=b.id
left join TBL_TSY_COURSETYPE c on c.id=A.COURSETYPEID

--Niên khóa

select a.code,A.AYNAME,A.STARTYEAR,A.ENDYEAR,A.NUMBEROFSEM,A.SEMESTERNUMBERINYEAR,A.SYMBOL,B.CODE from tbl_tsy_academicyear a join TBL_TSY_TRAININGSYSTEM b on a.trainingsystemid=b.id where b.id='9246C1762CAA446CB2E03A7F3D9CBBBE'



--Môn h?c version
select distinct D.COURSENAME||' ('||d.code||+')',g.stageofeducationid,C.SEMESTERORDER from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'


select distinct D.COURSENAME||' ('||d.code||+')',g.stageofeducationid,C.SEMESTERORDER from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'



select * from tbl_tsy_course where code='16011101'

select  a.code,A.COURSENAME,A.COURSECREDIT,C.CODE,B.CODE from TBL_tsy_course a left join TBL_TSY_SUBJECT b on A.SUBJECTID=b.id
left join TBL_TSY_COURSETYPE c on c.id=A.COURSETYPEID
where a.code='16011101'


---Version cho niên khóa
select distinct H.CODE,G.STAGEOFEDUCATIONID from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join LST_TSY_MAJORFIELD e on e.id=A.FIELDID
inner join lst_tsy_field f on f.id=E.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'


select distinct H.CODE,G.STAGEOFEDUCATIONID from TBL_TSY_STAGEOFEDUCATION a inner join TBL_TSY_ADMINISTRATIVECLASS b on 
a.id=B.STAGEOFEDUCATIONID
inner join TBL_TSY_COURSE_CURRIINSTAGE c on C.STAGEOFEDUCATIONID=A.ID
inner join tbl_tsy_course d on d.id=C.COURSEID
inner join lst_tsy_field f on f.id=a.FIELDID
inner join TBL_TSY_CURRICULUMNINSTAGE g on G.STAGEOFEDUCATIONID=A.ID
inner join TBL_TSY_ACADEMICYEAR h on h.id=A.AYID
inner join TBL_TSY_TRAININGSYSTEM i on i.id=H.TRAININGSYSTEMID
where i.ID='9246C1762CAA446CB2E03A7F3D9CBBBE'

--L?p h?c
select a.code,A.CLASSNAME,A.TYPECLASS,A.CLASSNAMETA,A.OPENCLASSDAY,b.id from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
inner join LST_TSY_MAJORFIELD c on c.id=B.FIELDID
join tbl_tsy_academicyear g on g.id=b.ayid
where g.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'



select a.code,A.CLASSNAME,A.TYPECLASS,A.CLASSNAMETA,A.OPENCLASSDAY,b.id from TBL_TSY_ADMINISTRATIVECLASS a 
inner join TBL_TSY_STAGEOFEDUCATION b on A.STAGEOFEDUCATIONID=B.ID
inner join LST_TSY_Field c on c.id=b.FIELDID
join tbl_tsy_academicyear g on g.id=b.ayid
where g.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'

FD097259D12448AE965089355FFA77BB
A6077B3DC8C3430CA2AD8BEA9FA8CA41


--Sinh viên
 select E.CLASSNAME,a.CODE,a.LASTMIDDLENAME,a.FIRSTNAME,a.LASTMIDDLENAME||' '||a.FIRSTNAME,to_char(a.BIRTHDATE,'DD/MM/YYYY'),a.PLACEOFBIRTH,B.CODE,a.STUDENTSTATUS,C.CODE,a.DISTRICT,D.CODE,
a.RESIDENTPOPULATION,a.KHICANBAOTINCHO,a.MOBILE_BK,A.GENDER
from tbl_stu_student a left join LST_STU_ZONE b on A.ZONEID=B.ID
left join LST_STU_NATIONALITY c on A.NATIONALITYID=C.ID
left join LST_COM_PROVINCE d on d.id=A.PROVINCEID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=A.ADMINCLASSID
left join TBL_TSY_STAGEOFEDUCATION f on f.id=E.STAGEOFEDUCATIONID
left join TBL_TSY_ACADEMICYEAR g on g.id=F.AYID
where G.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'


--H?c k?

select B.SCHOOLYEAR,B.ORDERINYEAR, B.SCHOOLYEAR||'_'||B.ORDERINYEAR,B.STARTDATE,B.ENDDATE,B.SEMESTERORDER,A.CODE,B.CODE,b.name
from TBL_TSY_ACADEMICYEAR a inner join TBL_TSY_SEMESTER b on A.ID=B.AYID 
where a.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'

--L?p môn h?c
select distinct E.CLASSNAME||'_'||b.code,E.CLASSNAME,b.COURSENAME||' ('||b.code||+')',h.code
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join TBL_TSY_STAGEOFEDUCATION f on f.id=E.STAGEOFEDUCATIONID
left join TBL_TSY_ACADEMICYEAR k on k.id=F.AYID
join tbl_tsy_semester h on h.ayid=k.id
where k.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE' and a.semester=(h.SCHOOLYEAR||'_'||ORDERINYEAR)
and e.code='02_?HCNTT_1'



create table BangDiem_09_06_18 as

(
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
a.MARK AS THI,NULL AS QT,NULL AS TKHP,
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
left join TBL_TSY_STAGEOFEDUCATION l on l.id=e.STAGEOFEDUCATIONID
left join TBL_TSY_ACADEMICYEAR m on m.id=l.AYID
WHERE c.CODE ='THI' and m.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,a.MARK AS QT,NULL AS TKHP,
a.mark4,a.RESULT,g.FULLNAME ,a.studytimes,f.code
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
left join TBL_TSY_STAGEOFEDUCATION l on l.id=e.STAGEOFEDUCATIONID
left join TBL_TSY_ACADEMICYEAR m on m.id=l.AYID
WHERE c.CODE ='QT' and m.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'
UNION
select d.code as mssv,E.CLASSNAME as tenlop,b.code as mamh,d.FIRSTNAME,E.CLASSNAME,b.COURSENAME,
NULL AS THI,NULL AS QT,a.MARK AS TKHP,
a.mark4,a.RESULT,g.FULLNAME,a.studytimes,f.code 
from TBL_PNT_TABLEMARK a inner join TBL_TSY_COURSE b on a.COURSEID=b.ID
inner join LST_PNT_MARKTYPE c on a.MARKTYPEID=c.ID
inner join TBL_STU_STUDENT d on a.STUDENTID=d.ID
left join TBL_STU_USER g on g.id=a.USERID
left join TBL_TSY_ADMINISTRATIVECLASS e on e.id=D.ADMINCLASSID
left join lst_pnt_symbolmark f on f.id=a.symbolmarkid
left join TBL_TSY_STAGEOFEDUCATION l on l.id=e.STAGEOFEDUCATIONID
left join TBL_TSY_ACADEMICYEAR m on m.id=l.AYID
WHERE c.CODE ='TKHP' and m.TRAININGSYSTEMID='9246C1762CAA446CB2E03A7F3D9CBBBE'
)
Select db.MSSV,db.CLASSNAME||'_'||db.MAMH, MAX(db.QT) AS QT,MAX(db.THI) AS THI, MAX(db.TKHP) AS TKHP,db.studytimes, MAX(db.RESULT) as KetQua,MAX(db.Code) as KyHieuDiem, MAX(db.Mark4) AS TKHP
FROm BangDiem_09_06_18 db
where db.mssv='0250080007'

GROUP BY db.MSSV,db.CLASSNAME,db.MAMH,db.studytimes



02_?HCNTT_1_31001001

02_?HCNTT_1_30111001

02_?HCNTT_1_20111001


Select db.MSSV,db.CLASSNAME,db.MAMH,db.CLASSNAME||'_'||db.MAMH as LMH, MAX(db.QT) AS QT,MAX(db.THI) AS THI, MAX(db.TKHP) AS TKHP,
MAX(db.MARK4) AS HE4,db.studytimes, MAX(db.RESULT) as KetQua,MAX(db.Code) as KyHieuDiem
FROm BangDiem_09_06_18 db
GROUP BY db.MSSV,db.CLASSNAME,db.MAMH,db.studytimes


A3A37E38F6084F37A7324EA22D9AAC50
*/
select course.code,GR.CODE from TBL_TSY_COURSE course join LST_STU_GROUP gr on GR.DOITUONGTHONGTINLIENQUANID=COURSE.DEPTID
